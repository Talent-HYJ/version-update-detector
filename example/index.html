<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Version Update Detector - ç®€å•ç¤ºä¾‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 { color: #333; margin-top: 0; }
    .info {
      background: #e7f3ff;
      border-left: 4px solid #409eff;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .info h3 { margin-top: 0; color: #409eff; }
    .btn {
      background: #409eff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    .btn:hover { background: #66b1ff; }
    .btn-outline {
      background: white;
      color: #409eff;
      border: 1px solid #409eff;
    }
    .btn-outline:hover {
      background: #ecf5ff;
    }
    code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    .status {
      padding: 10px;
      margin: 15px 0;
      background: #f9f9f9;
      border-radius: 4px;
      font-size: 14px;
    }
    ul {
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ“¦ Version Update Detector</h1>
    
    <div class="info">
      <h3>ğŸ” æ£€æµ‹æœºåˆ¶</h3>
      <ul>
        <li><strong>æ£€æµ‹æ–¹å¼</strong>ï¼šé€šè¿‡ <code>index.html</code> çš„ ETag å’Œ Last-Modified åˆ¤æ–­ç‰ˆæœ¬æ›´æ–°</li>
        <li><strong>è§¦å‘æ—¶æœº 1</strong>ï¼šé¡µé¢ä»ä¸å¯è§å˜ä¸ºå¯è§æ—¶ï¼ˆåˆ‡æ¢æ ‡ç­¾é¡µå›æ¥ï¼‰</li>
        <li><strong>è§¦å‘æ—¶æœº 2</strong>ï¼šé¡µé¢ä¿æŒæ‰“å¼€æ—¶ï¼Œæ¯ 30 åˆ†é’Ÿè‡ªåŠ¨æ£€æµ‹</li>
        <li><strong>è§¦å‘æ—¶æœº 3</strong>ï¼šæ£€æµ‹åˆ° JS/CSS ç­‰èµ„æºåŠ è½½å¤±è´¥æ—¶</li>
      </ul>
    </div>

    <div class="info" style="background: #fff3e0; border-left-color: #ff9800;">
      <h3>ğŸ’¡ æµ‹è¯•æ–¹æ³•</h3>
      <ol>
        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network æ ‡ç­¾</li>
        <li>è§‚å¯Ÿå¯¹ <code>/index.html</code> çš„ HEAD è¯·æ±‚</li>
        <li>åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼Œå†åˆ‡å›æ¥ï¼Œä¼šè§¦å‘æ£€æµ‹</li>
        <li>ç‚¹å‡»"æ¨¡æ‹Ÿæ›´æ–°"æŒ‰é’®ï¼ŒæŸ¥çœ‹æ›´æ–°æç¤ºå¼¹çª—</li>
      </ol>
    </div>

    <div style="margin: 30px 0;">
      <button class="btn" onclick="manualCheck()">æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°</button>
      <button class="btn btn-outline" onclick="simulateUpdate()">æ¨¡æ‹Ÿæ›´æ–°é€šçŸ¥</button>
      <button class="btn btn-outline" onclick="clearStorage()">æ¸…é™¤ç¼“å­˜</button>
    </div>

    <div id="status" class="status">
      çŠ¶æ€ï¼šå·²åˆå§‹åŒ–ï¼Œç­‰å¾…æ£€æµ‹...
    </div>

    <div class="info" style="background: #f3f4f6; border-left-color: #6b7280;">
      <h3>ğŸ“ ä½¿ç”¨ä»£ç </h3>
      <pre style="overflow-x: auto; background: #282c34; color: #abb2bf; padding: 15px; border-radius: 4px;"><code>import { createVersionUpdateDetector } from 'version-update-detector';

// ä¸€è¡Œä»£ç å®Œæˆé›†æˆ
const { detector, notification } = createVersionUpdateDetector();

// è‡ªå®šä¹‰é…ç½®ï¼ˆå¯é€‰ï¼‰
const { detector, notification } = createVersionUpdateDetector(
  {
    checkInterval: 30 * 60 * 1000, // 30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    skipInDevelopment: true // å¼€å‘ç¯å¢ƒè·³è¿‡æ£€æµ‹
  },
  {
    title: 'å‘ç°æ–°ç‰ˆæœ¬',
    description: 'è¯·åˆ·æ–°é¡µé¢ä»¥è·å¾—æœ€æ–°åŠŸèƒ½'
  }
);</code></pre>
    </div>
  </div>

  <script type="module">
    import { createVersionUpdateDetector } from '../dist/index.esm.js';

    // åˆå§‹åŒ–ç‰ˆæœ¬æ£€æµ‹å™¨
    const { detector, notification } = createVersionUpdateDetector(
      {
        skipInDevelopment: false, // æ¼”ç¤ºæ—¶ä¸è·³è¿‡å¼€å‘ç¯å¢ƒ
        checkInterval: 60 * 1000 // æ¼”ç¤ºç”¨ï¼š1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
      },
      {
        title: 'ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬',
        description: 'ä¸ºäº†è·å¾—æ›´å¥½çš„ä½“éªŒï¼Œè¯·åˆ·æ–°é¡µé¢æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚',
        buttonText: {
          refresh: 'ç«‹å³åˆ·æ–°',
          later: 'ç¨åæé†’'
        }
      },
      {
        onRefresh: () => {
          console.log('ç”¨æˆ·ç‚¹å‡»äº†åˆ·æ–°');
          updateStatus('æ­£åœ¨åˆ·æ–°é¡µé¢...');
        },
        onLater: () => {
          console.log('ç”¨æˆ·é€‰æ‹©ç¨åæé†’');
          updateStatus('ç”¨æˆ·é€‰æ‹©ç¨åæé†’ï¼Œå°†åœ¨ 10 åˆ†é’Ÿåå†æ¬¡æé†’');
        }
      }
    );

    // ç›‘å¬æ›´æ–°äº‹ä»¶
    detector.onUpdate((reason) => {
      console.log('æ£€æµ‹åˆ°æ›´æ–°ï¼ŒåŸå› :', reason);
      updateStatus(`æ£€æµ‹åˆ°æ›´æ–°ï¼åŸå› : ${reason}`);
    });

    // æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°
    window.manualCheck = async function() {
      updateStatus('æ­£åœ¨æ£€æŸ¥æ›´æ–°...');
      const hasUpdate = await detector.checkForUpdate();
      if (hasUpdate) {
        updateStatus('æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼');
      } else {
        updateStatus('å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
      }
    };

    // æ¨¡æ‹Ÿæ›´æ–°é€šçŸ¥
    window.simulateUpdate = function() {
      notification.show('version-change');
      updateStatus('å·²æ˜¾ç¤ºæ›´æ–°é€šçŸ¥å¼¹çª—');
    };

    // æ¸…é™¤æœ¬åœ°å­˜å‚¨
    window.clearStorage = function() {
      localStorage.clear();
      updateStatus('å·²æ¸…é™¤ç¼“å­˜ï¼Œä¸‹æ¬¡æ£€æŸ¥æ—¶ä¼šé‡æ–°è®°å½•ç‰ˆæœ¬ä¿¡æ¯');
    };

    function updateStatus(message) {
      const el = document.getElementById('status');
      if (el) {
        const time = new Date().toLocaleTimeString();
        el.textContent = `[${time}] ${message}`;
      }
    }

    // é¡µé¢å¸è½½æ—¶æ¸…ç†
    window.addEventListener('beforeunload', () => {
      detector.destroy();
      notification.destroy();
    });

    updateStatus('å·²åˆå§‹åŒ–ï¼Œæ­£åœ¨ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–...');
  </script>
</body>
</html>

