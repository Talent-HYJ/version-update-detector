<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Version Update Detector - CDN ä½¿ç”¨ç¤ºä¾‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .card {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }
    h1 {
      color: #333;
      margin-top: 0;
      font-size: 32px;
    }
    .badge {
      display: inline-block;
      background: #409eff;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 10px;
    }
    .info-box {
      background: #f0f9ff;
      border-left: 4px solid #409eff;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .info-box h3 {
      margin-top: 0;
      color: #409eff;
    }
    .code-box {
      background: #282c34;
      color: #abb2bf;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 20px 0;
    }
    .code-box code {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .btn {
      background: #409eff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
      transition: all 0.3s;
    }
    .btn:hover {
      background: #66b1ff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(64, 158, 255, 0.4);
    }
    .status {
      padding: 15px;
      margin: 20px 0;
      background: #f9f9f9;
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      border: 1px solid #e0e0e0;
    }
    ul {
      line-height: 2;
    }
    .highlight {
      background: #fff3cd;
      padding: 2px 6px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>
      ğŸ“¦ Version Update Detector
      <span class="badge">CDN ç¤ºä¾‹</span>
    </h1>
    
    <div class="info-box">
      <h3>âœ¨ æœ¬é¡µé¢æ¼”ç¤ºäº†é€šè¿‡ CDN ä½¿ç”¨è¯¥åº“</h3>
      <p>æ— éœ€ npm å®‰è£…ï¼Œç›´æ¥é€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾å¼•å…¥å³å¯ä½¿ç”¨ï¼</p>
    </div>

    <div class="info-box" style="background: #fff3e0; border-left-color: #ff9800;">
      <h3>ğŸ¯ æµ‹è¯•æ­¥éª¤</h3>
      <ol>
        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Console æ ‡ç­¾</li>
        <li>æŸ¥çœ‹åˆå§‹åŒ–æ—¥å¿—</li>
        <li>åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼Œå†åˆ‡å›æ¥ï¼ˆè§¦å‘å¯è§æ€§æ£€æµ‹ï¼‰</li>
        <li>ç‚¹å‡»ä¸‹æ–¹"æ¨¡æ‹Ÿæ›´æ–°é€šçŸ¥"æŒ‰é’®æŸ¥çœ‹å¼¹çª—æ•ˆæœ</li>
      </ol>
    </div>

    <div style="margin: 30px 0;">
      <button class="btn" onclick="manualCheck()">ğŸ” æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°</button>
      <button class="btn" onclick="simulateUpdate()">ğŸ¨ æ¨¡æ‹Ÿæ›´æ–°é€šçŸ¥</button>
      <button class="btn" style="background: #e74c3c;" onclick="clearStorage()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
    </div>

    <div id="status" class="status">
      â³ æ­£åœ¨åˆå§‹åŒ–...
    </div>

    <div class="code-box">
      <code>&lt;!-- å¼•å…¥åº“ --&gt;<br>
&lt;script src="../dist/index.umd.js"&gt;&lt;/script&gt;<br>
<br>
&lt;script&gt;<br>
&nbsp;&nbsp;// é€šè¿‡å…¨å±€å˜é‡è®¿é—®<br>
&nbsp;&nbsp;const { createVersionUpdateDetector } = VersionUpdateDetector;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;// åˆ›å»ºæ£€æµ‹å™¨<br>
&nbsp;&nbsp;const { detector, notification } = createVersionUpdateDetector({<br>
&nbsp;&nbsp;&nbsp;&nbsp;skipInDevelopment: false // CDN ä½¿ç”¨å»ºè®®è®¾ä¸º false<br>
&nbsp;&nbsp;});<br>
&lt;/script&gt;</code>
    </div>

    <div class="info-box" style="background: #e8f5e9; border-left-color: #4caf50;">
      <h3>ğŸ“š å¯ç”¨çš„ API</h3>
      <ul>
        <li><span class="highlight">VersionUpdateDetector.createVersionUpdateDetector()</span> - å¿«é€Ÿåˆ›å»º</li>
        <li><span class="highlight">VersionUpdateDetector.VersionDetector</span> - æ£€æµ‹å™¨ç±»</li>
        <li><span class="highlight">VersionUpdateDetector.UpdateNotification</span> - é€šçŸ¥ç»„ä»¶ç±»</li>
      </ul>
    </div>
  </div>

  <!-- å¼•å…¥åº“ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰ -->
  <script src="../dist/index.umd.js"></script>
  
  <!-- ä½¿ç”¨åº“ -->
  <script>
    // é€šè¿‡å…¨å±€å˜é‡ VersionUpdateDetector è®¿é—®
    const { createVersionUpdateDetector, VersionDetector, UpdateNotification } = VersionUpdateDetector;
    
    // åˆå§‹åŒ–æ£€æµ‹å™¨
    const { detector, notification } = createVersionUpdateDetector(
      {
        skipInDevelopment: false, // CDN ä½¿ç”¨æ—¶å»ºè®®è®¾ä¸º false
        checkInterval: 60 * 1000 // æ¼”ç¤ºç”¨ï¼š1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
      },
      {
        title: 'ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬',
        description: 'ä¸ºäº†è·å¾—æ›´å¥½çš„ä½“éªŒï¼Œè¯·åˆ·æ–°é¡µé¢æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚',
        buttonText: {
          refresh: 'ç«‹å³åˆ·æ–°',
          later: 'ç¨åæé†’'
        }
      },
      {
        onRefresh: () => {
          console.log('ğŸ‘¤ ç”¨æˆ·ç‚¹å‡»äº†åˆ·æ–°');
          updateStatus('ç”¨æˆ·ç‚¹å‡»äº†åˆ·æ–°ï¼Œæ­£åœ¨é‡è½½é¡µé¢...');
        },
        onLater: () => {
          console.log('â° ç”¨æˆ·é€‰æ‹©ç¨åæé†’');
          updateStatus('ç”¨æˆ·é€‰æ‹©ç¨åæé†’');
        }
      }
    );

    // ç›‘å¬æ›´æ–°äº‹ä»¶
    detector.onUpdate((reason) => {
      console.log('ğŸ”” æ£€æµ‹åˆ°æ›´æ–°ï¼ŒåŸå› :', reason);
      updateStatus(`æ£€æµ‹åˆ°æ›´æ–°ï¼åŸå› : ${reason}`);
    });

    // æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°
    window.manualCheck = async function() {
      updateStatus('æ­£åœ¨æ£€æŸ¥æ›´æ–°...');
      const hasUpdate = await detector.checkForUpdate();
      if (hasUpdate) {
        updateStatus('âœ… æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼');
      } else {
        updateStatus('âœ… å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
      }
    };

    // æ¨¡æ‹Ÿæ›´æ–°é€šçŸ¥
    window.simulateUpdate = function() {
      notification.show('version-change');
      updateStatus('å·²æ˜¾ç¤ºæ›´æ–°é€šçŸ¥å¼¹çª—ï¼ˆæ¨¡æ‹Ÿï¼‰');
    };

    // æ¸…é™¤æœ¬åœ°å­˜å‚¨
    window.clearStorage = function() {
      localStorage.clear();
      updateStatus('âœ… å·²æ¸…é™¤ç¼“å­˜ï¼Œä¸‹æ¬¡æ£€æŸ¥æ—¶ä¼šé‡æ–°è®°å½•ç‰ˆæœ¬ä¿¡æ¯');
    };

    function updateStatus(message) {
      const el = document.getElementById('status');
      if (el) {
        const time = new Date().toLocaleTimeString();
        el.innerHTML = `<strong>[${time}]</strong> ${message}`;
      }
    }

    // åˆå§‹åŒ–å®Œæˆ
    console.log('âœ… Version Update Detector å·²é€šè¿‡ CDN æˆåŠŸåˆå§‹åŒ–');
    console.log('ğŸŒ å…¨å±€å˜é‡:', VersionUpdateDetector);
    updateStatus('âœ… åˆå§‹åŒ–æˆåŠŸï¼æ­£åœ¨ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–å’Œå®šæ—¶æ£€æµ‹...');

    // é¡µé¢å¸è½½æ—¶æ¸…ç†
    window.addEventListener('beforeunload', () => {
      detector.destroy();
      notification.destroy();
    });
  </script>
</body>
</html>

